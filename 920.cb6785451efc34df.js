"use strict";(self.webpackChunksaiph=self.webpackChunksaiph||[]).push([[920],{2920:(G,h,l)=>{l.r(h),l.d(h,{UsuariosPageModule:()=>T});var _=l(6778),s=l(4341),c=l(177),v=l(6143),p=l(467),C=l(8032),u=l.n(C),e=l(540),M=l(9389);const P=function(t,i,o){return{admin:t,evaluator:i,guest:o}},x=function(t,i,o){return{"bi-shield":t,"bi-award":i,"bi-eye":o}};function F(t,i){if(1&t){const o=e.RV6();e.j41(0,"div",47)(1,"div",48)(2,"div",49)(3,"span",50),e.nrm(4,"i",51),e.EFF(5),e.nI1(6,"titlecase"),e.k0s()(),e.j41(7,"div",52)(8,"div",53),e.nrm(9,"i",54),e.j41(10,"span"),e.EFF(11),e.k0s()(),e.j41(12,"div",53),e.nrm(13,"i",55),e.j41(14,"span"),e.EFF(15),e.k0s()(),e.j41(16,"div",53),e.nrm(17,"i",56),e.j41(18,"span"),e.EFF(19),e.nI1(20,"date"),e.k0s()(),e.j41(21,"div",57)(22,"button",58),e.bIt("click",function(){const a=e.eBV(o).$implicit,d=e.XpG(2);return e.Njj(d.editUser(a))}),e.EFF(23," Editar "),e.k0s(),e.j41(24,"button",59),e.bIt("click",function(){const a=e.eBV(o).$implicit,d=e.XpG(2);return e.Njj(d.confirmDelete(a))}),e.EFF(25," Eliminar "),e.k0s()()()()()}if(2&t){const o=i.$implicit;e.R7$(3),e.Y8G("ngClass",e.sMw(11,P,"administrador"===o.rol,"evaluador"===o.rol,"invitado"===o.rol)),e.R7$(1),e.Y8G("ngClass",e.sMw(15,x,"administrador"===o.rol,"evaluador"===o.rol,"invitado"===o.rol)),e.R7$(1),e.SpI(" ",e.bMT(6,6,o.rol)," "),e.R7$(6),e.JRh(o.nombre),e.R7$(4),e.JRh(o.email),e.R7$(4),e.SpI("Creado: ",e.i5U(20,8,null==o.createdAt?null:o.createdAt.toDate(),"dd/MM/yyyy"),"")}}function w(t,i){1&t&&(e.j41(0,"div",60)(1,"div",61),e.nrm(2,"i",62),e.j41(3,"p",63),e.EFF(4,"No se encontraron usuarios"),e.k0s()()())}function k(t,i){if(1&t&&(e.j41(0,"div",44),e.DNE(1,F,26,19,"div",45),e.DNE(2,w,5,0,"div",46),e.k0s()),2&t){const o=e.XpG();e.R7$(1),e.Y8G("ngForOf",o.filteredUsers),e.R7$(1),e.Y8G("ngIf",0===o.filteredUsers.length)}}function y(t,i){1&t&&(e.j41(0,"div",64)(1,"div",65)(2,"div",66)(3,"span",67),e.EFF(4,"Cargando..."),e.k0s()(),e.j41(5,"p",63),e.EFF(6,"Cargando usuarios..."),e.k0s()()())}function O(t,i){1&t&&(e.j41(0,"div",68),e.EFF(1," El nombre es requerido "),e.k0s())}function E(t,i){1&t&&(e.j41(0,"div",68),e.EFF(1," Ingresa un correo v\xe1lido "),e.k0s())}function U(t,i){1&t&&(e.j41(0,"div",69),e.EFF(1," La contrase\xf1a debe tener al menos 6 caracteres "),e.k0s())}function j(t,i){if(1&t&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&t){const o=e.XpG();e.R7$(1),e.JRh(o.isEditMode?"Actualizar":"Crear usuario")}}function I(t,i){1&t&&(e.j41(0,"span"),e.nrm(1,"span",70),e.EFF(2," Guardando... "),e.k0s())}const R=[{path:"",component:(()=>{class t{constructor(o,n){this.fb=o,this.firebaseService=n,this.usuarios=[],this.filteredUsers=[],this.searchTerm="",this.showPassword=!1,this.isLoading=!1,this.isLoadingUsers=!0,this.isEditMode=!1,this.currentUserId=null}ngOnInit(){this.initForm(),this.loadUsers(),this.setupModalListeners()}setupModalListeners(){const o=document.getElementById("exampleModal");o&&(o.addEventListener("show.bs.modal",()=>{this.modalInstance||(this.modalInstance=bootstrap.Modal.getInstance(o))}),o.addEventListener("hidden.bs.modal",()=>{this.isLoading||(this.userForm.reset({rol:"evaluador"}),this.showPassword=!1,this.isEditMode=!1,this.currentUserId=null)}))}initForm(){this.userForm=this.fb.group({nombre:["",[s.k0.required,s.k0.minLength(3)]],email:["",[s.k0.required,s.k0.email]],password:["",[s.k0.required,s.k0.minLength(6)]],rol:["evaluador",s.k0.required]})}loadUsers(){var o=this;return(0,p.A)(function*(){try{o.isLoadingUsers=!0;const n=yield o.firebaseService.getDocuments("usuarios");o.usuarios=n,o.filteredUsers=[...o.usuarios]}catch(n){console.error("Error cargando usuarios:",n),u().fire({icon:"error",title:"Error",text:"No se pudieron cargar los usuarios"})}finally{o.isLoadingUsers=!1}})()}filterUsers(){const o=this.searchTerm.toLowerCase().trim();this.filteredUsers=o?this.usuarios.filter(n=>n.nombre.toLowerCase().includes(o)||n.email.toLowerCase().includes(o)):[...this.usuarios]}togglePasswordVisibility(){this.showPassword=!this.showPassword}getRolDescription(){const o=this.userForm.get("rol")?.value;return{evaluador:"Puede crear y gestionar evaluaciones",administrador:"Acceso completo al sistema",invitado:"Solo puede ver evaluaciones y resultados"}[o]||""}saveUser(){var o=this;return(0,p.A)(function*(){if(o.userForm.invalid)o.userForm.markAllAsTouched();else{o.isLoading=!0;try{const n={nombre:o.userForm.value.nombre,email:o.userForm.value.email,rol:o.userForm.value.rol,updatedAt:new Date};if(o.isEditMode&&o.currentUserId)yield o.firebaseService.updateDocument("usuarios",o.currentUserId,n),u().fire({icon:"success",title:"Usuario actualizado",text:"El usuario se actualiz\xf3 correctamente",timer:2e3,showConfirmButton:!1});else{const r={...n,password:o.userForm.value.password,createdAt:new Date};yield o.firebaseService.addDocument("usuarios",r),u().fire({icon:"success",title:"Usuario creado",text:"El usuario se cre\xf3 correctamente",timer:2e3,showConfirmButton:!1})}o.closeModal(),yield o.loadUsers()}catch(n){console.error("Error guardando usuario:",n),u().fire({icon:"error",title:"Error",text:"No se pudo guardar el usuario"})}finally{o.isLoading=!1}}})()}editUser(o){this.isEditMode=!0,this.currentUserId=o.id||null,this.userForm.patchValue({nombre:o.nombre,email:o.email,rol:o.rol}),this.userForm.get("password")?.clearValidators(),this.userForm.get("password")?.updateValueAndValidity();const n=document.getElementById("exampleModal");n&&(this.modalInstance=new bootstrap.Modal(n),this.modalInstance.show())}confirmDelete(o){var n=this;return(0,p.A)(function*(){(yield u().fire({title:"\xbfEliminar usuario?",text:`\xbfEst\xe1s seguro de eliminar a ${o.nombre}? Esta acci\xf3n no se puede deshacer.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#e05656",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed&&o.id&&(yield n.deleteUser(o.id))})()}deleteUser(o){var n=this;return(0,p.A)(function*(){try{yield n.firebaseService.deleteDocument("usuarios",o),u().fire({icon:"success",title:"Usuario eliminado",text:"El usuario se elimin\xf3 correctamente",timer:2e3,showConfirmButton:!1}),yield n.loadUsers()}catch(r){console.error("Error eliminando usuario:",r),u().fire({icon:"error",title:"Error",text:"No se pudo eliminar el usuario"})}})()}closeModal(){this.userForm.reset({rol:"evaluador"}),this.showPassword=!1,this.isEditMode=!1,this.currentUserId=null,this.userForm.get("password")?.setValidators([s.k0.required,s.k0.minLength(6)]),this.userForm.get("password")?.updateValueAndValidity();const o=document.getElementById("exampleModal");if(o){if(this.modalInstance)this.modalInstance.hide();else{const r=bootstrap.Modal.getInstance(o);r&&r.hide()}const n=document.querySelector(".modal-backdrop");n&&n.remove(),document.body.classList.remove("modal-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right")}}static{this.\u0275fac=function(n){return new(n||t)(e.rXU(s.ok),e.rXU(M.f))}}static{this.\u0275cmp=e.VBU({type:t,selectors:[["app-usuarios-page"]],decls:67,vars:21,consts:[[1,"py-4","usuarios-page"],[1,"row","align-items-start","mb-3"],[1,"col"],[1,"fw-bold","title"],[1,"text-secondary","subtitle"],[1,"col-auto","ms-auto"],["data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-new-user"],[1,"bi","bi-person-plus","me-2"],[1,"row","mb-4"],[1,"col-12","col-sm-6","col-md-5","col-lg-4"],[1,"search-input"],[1,"bi","bi-search"],["type","text","placeholder","Buscar por nombre o correo...",3,"ngModel","ngModelChange","input"],["class","row g-4",4,"ngIf"],["class","row",4,"ngIf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","custom-modal"],[1,"modal-content","user-modal"],[1,"modal-header","border-0"],["id","exampleModalLabel",1,"modal-title","modal-title-main"],[1,"modal-subtitle"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","placeholder","Ej: Juan P\xe9rez","formControlName","nombre",1,"form-control","input-field"],["class","invalid-feedback",4,"ngIf"],["type","email","placeholder","usuario@ejemplo.com","formControlName","email",1,"form-control","input-field"],[1,"password-input-wrapper"],["placeholder","M\xednimo 6 caracteres","formControlName","password",1,"form-control","input-field",3,"type"],["type","button",1,"password-toggle-btn",3,"click"],["class","invalid-feedback d-block",4,"ngIf"],[1,"mb-2"],[1,"d-flex","align-items-center","gap-2"],["formControlName","rol",1,"form-select","input-select"],["value","evaluador"],["value","administrador"],["value","invitado"],[1,"text-muted","helper-text"],[1,"modal-footer","border-0"],["type","button","data-bs-dismiss","modal",1,"btn","btn-cancel",3,"click"],["type","button",1,"btn","btn-primary-dark",3,"disabled","click"],[4,"ngIf"],[1,"row","g-4"],["class","col-12 col-md-4",4,"ngFor","ngForOf"],["class","col-12",4,"ngIf"],[1,"col-12","col-md-4"],[1,"user-card"],[1,"user-card-header","mt-3"],[1,"role-badge",3,"ngClass"],[1,"me-1",3,"ngClass"],[1,"user-card-body"],[1,"info-line"],[1,"bi","bi-person","me-2"],[1,"bi","bi-envelope","me-2"],[1,"bi","bi-calendar3","me-2"],[1,"actions","mt-4"],[1,"btn","btn-outline-primary-dark","me-2",3,"click"],[1,"btn","btn-danger-soft",3,"click"],[1,"col-12"],[1,"text-center","py-5"],[1,"bi","bi-inbox",2,"font-size","3rem","color","#8b97a6"],[1,"text-muted","mt-3"],[1,"row"],[1,"col-12","text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"invalid-feedback"],[1,"invalid-feedback","d-block"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,r){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.EFF(4,"Usuarios"),e.k0s(),e.j41(5,"p",4),e.EFF(6,"Gestiona los usuarios del sistema"),e.k0s()(),e.j41(7,"div",5)(8,"button",6),e.nrm(9,"i",7),e.EFF(10," Nuevo Usuario "),e.k0s()()(),e.j41(11,"div",8)(12,"div",9)(13,"div",10),e.nrm(14,"i",11),e.j41(15,"input",12),e.bIt("ngModelChange",function(d){return r.searchTerm=d})("input",function(){return r.filterUsers()}),e.k0s()()()(),e.DNE(16,k,3,2,"div",13),e.DNE(17,y,7,0,"div",14),e.k0s(),e.j41(18,"div",15)(19,"div",16)(20,"div",17)(21,"div",18)(22,"div")(23,"h5",19),e.EFF(24," Nuevo Usuario "),e.k0s(),e.j41(25,"p",20),e.EFF(26,"Crea un nuevo usuario para el sistema"),e.k0s()(),e.nrm(27,"button",21),e.k0s(),e.j41(28,"div",22)(29,"form",23)(30,"div",24)(31,"label",25),e.EFF(32,"Nombre Completo"),e.k0s(),e.nrm(33,"input",26),e.DNE(34,O,2,0,"div",27),e.k0s(),e.j41(35,"div",24)(36,"label",25),e.EFF(37,"Correo Electr\xf3nico"),e.k0s(),e.nrm(38,"input",28),e.DNE(39,E,2,0,"div",27),e.k0s(),e.j41(40,"div",24)(41,"label",25),e.EFF(42,"Contrase\xf1a"),e.k0s(),e.j41(43,"div",29),e.nrm(44,"input",30),e.j41(45,"button",31),e.bIt("click",function(){return r.togglePasswordVisibility()}),e.nrm(46,"i"),e.k0s()(),e.DNE(47,U,2,0,"div",32),e.k0s(),e.j41(48,"div",33)(49,"label",25),e.EFF(50,"Rol"),e.k0s(),e.j41(51,"div",34)(52,"select",35)(53,"option",36),e.EFF(54,"Evaluador"),e.k0s(),e.j41(55,"option",37),e.EFF(56,"Administrador"),e.k0s(),e.j41(57,"option",38),e.EFF(58,"Invitado"),e.k0s()()(),e.j41(59,"small",39),e.EFF(60),e.k0s()()()(),e.j41(61,"div",40)(62,"button",41),e.bIt("click",function(){return r.closeModal()}),e.EFF(63," Cancelar "),e.k0s(),e.j41(64,"button",42),e.bIt("click",function(){return r.saveUser()}),e.DNE(65,j,2,1,"span",43),e.DNE(66,I,3,0,"span",43),e.k0s()()()()()),2&n){let a,d,m,g,b,f;e.R7$(15),e.Y8G("ngModel",r.searchTerm),e.R7$(1),e.Y8G("ngIf",!r.isLoadingUsers),e.R7$(1),e.Y8G("ngIf",r.isLoadingUsers),e.R7$(12),e.Y8G("formGroup",r.userForm),e.R7$(4),e.AVh("is-invalid",(null==(a=r.userForm.get("nombre"))?null:a.invalid)&&(null==(a=r.userForm.get("nombre"))?null:a.touched)),e.R7$(1),e.Y8G("ngIf",(null==(d=r.userForm.get("nombre"))?null:d.invalid)&&(null==(d=r.userForm.get("nombre"))?null:d.touched)),e.R7$(4),e.AVh("is-invalid",(null==(m=r.userForm.get("email"))?null:m.invalid)&&(null==(m=r.userForm.get("email"))?null:m.touched)),e.R7$(1),e.Y8G("ngIf",(null==(g=r.userForm.get("email"))?null:g.invalid)&&(null==(g=r.userForm.get("email"))?null:g.touched)),e.R7$(5),e.AVh("is-invalid",(null==(b=r.userForm.get("password"))?null:b.invalid)&&(null==(b=r.userForm.get("password"))?null:b.touched)),e.Y8G("type",r.showPassword?"text":"password"),e.R7$(1),e.BMQ("aria-label",r.showPassword?"Ocultar contrase\xf1a":"Mostrar contrase\xf1a"),e.R7$(1),e.HbH(r.showPassword?"bi bi-eye-slash":"bi bi-eye"),e.R7$(1),e.Y8G("ngIf",(null==(f=r.userForm.get("password"))?null:f.invalid)&&(null==(f=r.userForm.get("password"))?null:f.touched)),e.R7$(13),e.SpI(" ",r.getRolDescription()," "),e.R7$(4),e.Y8G("disabled",r.userForm.invalid||r.isLoading),e.R7$(1),e.Y8G("ngIf",!r.isLoading),e.R7$(1),e.Y8G("ngIf",r.isLoading)}},dependencies:[c.YU,c.Sq,c.bT,s.qT,s.xH,s.y7,s.me,s.wz,s.BC,s.cb,s.j4,s.JD,s.vS,c.PV,c.vh],styles:[".usuarios-page[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#1b263b}.usuarios-page[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin-top:2px;font-size:.95rem}.usuarios-page[_ngcontent-%COMP%]   .btn-new-user[_ngcontent-%COMP%]{background-color:#1b263b;color:#fff;border:1px solid #1b263b;border-radius:8px;padding:8px 14px;font-weight:500;font-size:.95rem}.usuarios-page[_ngcontent-%COMP%]   .btn-new-user[_ngcontent-%COMP%]:hover{background-color:#465a75;border-color:#465a75}.usuarios-page[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#e0e1dd;border:1px solid #c3bcbc;border-radius:10px;padding:6px 10px;height:36px}.usuarios-page[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#5b6a7c}.usuarios-page[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;outline:none;background:transparent;color:#1b263b}.usuarios-page[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#8b97a6}.usuarios-page[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #dcdfe4;border-radius:10px;overflow:hidden;box-shadow:0 2px 8px #1b263b0d}.usuarios-page[_ngcontent-%COMP%]   .user-card-header[_ngcontent-%COMP%]{padding:12px 14px;display:flex;align-items:center;justify-content:space-between}.usuarios-page[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:9999px;font-size:.82rem;font-weight:500}.usuarios-page[_ngcontent-%COMP%]   .role-badge.admin[_ngcontent-%COMP%]{background:#1b263b;color:#fff}.usuarios-page[_ngcontent-%COMP%]   .role-badge.evaluator[_ngcontent-%COMP%]{background:#465a75;color:#fff}.usuarios-page[_ngcontent-%COMP%]   .user-card-body[_ngcontent-%COMP%]{padding:14px}.usuarios-page[_ngcontent-%COMP%]   .info-line[_ngcontent-%COMP%]{display:flex;align-items:center;color:#5b6a7c;margin-bottom:8px}.usuarios-page[_ngcontent-%COMP%]   .btn-outline-primary-dark[_ngcontent-%COMP%]{color:#1b263b;border:1px solid #1b263b;border-radius:8px;padding:6px 10px;font-weight:500}.usuarios-page[_ngcontent-%COMP%]   .btn-outline-primary-dark[_ngcontent-%COMP%]:hover{background:#465a75;border-color:#465a75;color:#fff}.usuarios-page[_ngcontent-%COMP%]   .btn-danger-soft[_ngcontent-%COMP%]{color:#e05656;border:1px solid #e89999;background:#fff;border-radius:8px;padding:6px 10px;font-weight:500}.usuarios-page[_ngcontent-%COMP%]   .btn-danger-soft[_ngcontent-%COMP%]:hover{background:#ffecec;border-color:#e05656}.custom-modal[_ngcontent-%COMP%]{max-width:640px}.user-modal[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 8px 24px #1b263b33}.user-modal[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:16px 24px 6px}.user-modal[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{padding:8px 24px 16px}.modal-title-main[_ngcontent-%COMP%]{color:#1b263b;font-weight:700;font-size:1.25rem;line-height:1.3;margin-bottom:0}.modal-subtitle[_ngcontent-%COMP%]{color:#5b6a7c;margin-top:4px;margin-bottom:0}.input-field[_ngcontent-%COMP%]{background:#ffffff;border:1px solid #e0e1dd;border-radius:10px;height:44px;padding:8px 12px}.input-field[_ngcontent-%COMP%]:focus{border-color:#465a75;box-shadow:0 0 0 4px #465a7526}.input-select[_ngcontent-%COMP%]{background:#ffffff;border:1px solid #e0e1dd;border-radius:8px;height:36px;padding:4px 8px;color:#1b263b;width:200px}.input-select[_ngcontent-%COMP%]:focus{border-color:#465a75;box-shadow:0 0 0 4px #465a7526}.btn-cancel[_ngcontent-%COMP%]{background:#fff;border:1px solid #dbe2ea;color:#1b263b;border-radius:10px;padding:8px 14px;font-weight:500}.btn-primary-dark[_ngcontent-%COMP%]{background:#1b263b;color:#fff;border-radius:10px;padding:8px 14px;font-weight:600}.btn-primary-dark[_ngcontent-%COMP%]:hover{background:#465a75}.form-label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#000}.helper-text[_ngcontent-%COMP%]{margin-top:6px}.password-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.password-input-wrapper[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{padding-right:45px}.password-input-wrapper[_ngcontent-%COMP%]   .password-toggle-btn[_ngcontent-%COMP%]{position:absolute;right:10px;background:transparent;border:none;color:#5b6a7c;cursor:pointer;padding:8px;display:flex;align-items:center;justify-content:center;transition:color .2s ease}.password-input-wrapper[_ngcontent-%COMP%]   .password-toggle-btn[_ngcontent-%COMP%]:hover{color:#1b263b}.password-input-wrapper[_ngcontent-%COMP%]   .password-toggle-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}.is-invalid[_ngcontent-%COMP%]{border-color:#e05656!important}.invalid-feedback[_ngcontent-%COMP%]{color:#e05656;font-size:.875rem;margin-top:4px}.role-badge.guest[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem;border-width:.15em}"]})}}return t})()}];let $=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=e.$C({type:t})}static{this.\u0275inj=e.G2t({imports:[v.iI.forChild(R),v.iI]})}}return t})(),T=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=e.$C({type:t})}static{this.\u0275inj=e.G2t({imports:[$,_.PrivateModule,c.MD,s.X1,s.YN]})}}return t})()}}]);